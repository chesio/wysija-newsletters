var query_offset=0,wysappend=0,totalReached=!1,searchRunning=!1,slider=null,colorpicker=null;jQuery(function(s){function e(){s(".submit-box").addClass("counting");var e=parseInt(s(".search_results .checkbox:checked").length,10);0===e?t():o(e+" "+wysijatrans.post_selected)}function t(){s(".submit-box").removeClass("counting"),c()}function i(){return wysappend=query_offset=0,a(),!1}function n(){if(null===slider){var e=32,t=564,i=Math.min(Math.max(e,parseInt(s("#slider_info span").html())),t);(slider=new Control.Slider("slider_handle","image_width_slider",{range:$R(e,t),slideValue:i,axis:"horizontal",onSlide:function(e){var t=parseInt(e,10);s("#slider_info").find("span").html(t),s("#image_width").val(t)},onChange:function(e){var t=parseInt(e,10);s("#slider_info").find("span").html(t),s("#image_width").val(t)}})).setValue(i)}}function a(){var e="";wysappend||s("#results").html(e),wysijaAJAX.task="get_articles",wysijaAJAX.data=s("#articles-form").serializeArray(),wysijaAJAX.query_offset=query_offset,l(wysijatrans.loading_results),jQuery.ajax({type:"POST",url:wysijaAJAX.ajaxurl,data:wysijaAJAX,success:f,error:m,dataType:"json"})}function l(e){t(),s(".submit-box").addClass("loading"),o(e)}function o(e){e!==undefined&&s("#loading-message").html(e)}function c(){s("#loading-message").html("")}function r(){s(".submit-box").removeClass("loading"),c(),e()}function d(){s("#title_position_block")["title"===s('input[name="post_content"]:checked').val()?"hide":"show"](),s("#title_tag_list")["title"===s('input[name="post_content"]:checked').val()?"show":"hide"](),0<s("#advanced:visible").length&&(0<s("#title_tag_list:hidden").length&&"list"===s('input[name="title_tag"]:checked').val()&&s('input[name="title_tag"][value="h2"]').attr("checked","checked"),"list"===s('input[name="title_tag"]:checked').val()?u(["image","author","category","readmore","divider","bgcolor"]):h(["image","author","category","readmore","divider","bgcolor"]))}function u(e){s.each(e,function(e,t){s("#"+t+"-block").hide()})}function h(e){s.each(e,function(e,t){s("#"+t+"-block").show()})}function p(){null===colorpicker&&(colorpicker=!0,s("input.color").modcoder_excolor({hue_bar:1,border_color:"#969696",anim_speed:"fast",round_corners:!1,shadow_size:2,shadow_color:"#f0f0f0",background_color:"#ececec",backlight:!1,label_color:"#333333",effect:"fade",show_input:!1,z_index:2e4,callback_on_open:function(){s("html, body").animate({scrollTop:s("#modcoder_colorpicker_wrapper:visible").offset().top},200)}}))}function _(){s("#image_block")[0<s('input[name="title_tag"][value="list"]:checked').length?"hide":"show"]()}function g(){var e=s('input[name="image_alignment"]:checked').val(),t=!0,i=32,a=325;"center"===e?a=564:"none"===e&&(t=!1),!0===t?(s("#image_width_block").show(),n(),slider.range=$R(i,a),slider.setValue(slider.value)):s("#image_width_block").hide()}function f(e){var a="",n=null;e.result.result?(a='<ul class="search_results">',s.each(e.result.posts,function(e,t){n={src:null,alt:"",title:""},null!==t.post_image&&(n.src=t.post_image.src,n.alt=t.post_image.alt,n.title=t.post_title);var i=query_offset+e;a+='<li id="post-'+i+'" class="clearfix">',a+='<div class="checkbox_container">',a+='<input id="post-checkbox-'+i+'" data-post-id="'+i+'" type="checkbox" class="checkbox" value="'+t.ID+'" name="post_selection" />',a+="</div>",null!==n.src?(a+='<div class="thumbnail"><img width="60" title="'+n.title+'" src="'+n.src+'" alt="'+n.alt+'" /></div>',a+='<label class="with_thumbnail" for="post-checkbox-'+i+'">'+t.post_title+"</label>"):a+='<label for="post-checkbox-'+i+'">'+t.post_title+"</label>",a+='<span class="cpt-type">'+t.post_type+" - <small>"+t.post_status+"</small></span>",a+="</li>"}),a+="</ul>"):a=e.result.append?"":'<p class="message"><strong>'+e.result.msg+"</strong></p>",e.result.append?""!==a&&s("#results").append("<hr />"+a):s("#results").html(a),wysappend=0,searchRunning=!1,totalReached=parseInt(e.result.total)===s("ul.search_results li").length,r()}function m(){searchRunning=!1,wysappend=0}function w(){0!==s("#advanced:hidden").length&&!0!==searchRunning&&(searchRunning=!0,query_offset+=10,wysappend=1,a())}s("#toggle-advanced").toggle(function(){return s(this).html(wysijatrans.hide_advanced),s("#advanced").show(),s("#basic").hide(),n(),d(),g(),_(),p(),s(this).blur(),!1},function(){return s(this).html(wysijatrans.show_advanced),s("#basic").show(),s("#advanced").hide(),s(this).blur(),!1}),s("#back-selection").click(function(){return s("#toggle-advanced").trigger("click"),!1}),s("#insert-selection").click(function(){var i=[],e=s('#results input[name="post_selection"]:checked'),t=[],a=["readmore","author_label","category_label"];return 0===e.length||(s.each(e,function(e,t){i.push(s(t).val())}),s("#articles-form").serializeArray().each(function(e){a.include(e.name)&&(e.value=window.parent.Wysija.encodeHtmlValue(e.value)),t.push(e)}),wysijaAJAX.task="insert_articles",wysijaAJAX.post_ids=i.join(","),wysijaAJAX.data=t,wysijaAJAX._wpnonce=wysijanonces.campaigns.insert_articles,wysijaAJAX.divider={src:window.parent.$$('.wysija_item[wysija_type="divider"]')[0].readAttribute("wysija_src"),width:window.parent.$$('.wysija_item[wysija_type="divider"]')[0].readAttribute("wysija_width"),height:window.parent.$$('.wysija_item[wysija_type="divider"]')[0].readAttribute("wysija_height")},l(wysijatrans.inserting_selection),jQuery.ajax({type:"POST",url:wysijaAJAX.ajaxurl,data:wysijaAJAX,success:function(e){window.parent.WysijaPopup.success(e.result.posts),r()},error:m,dataType:"json"})),!1}),s(document).on("click",".search_results .checkbox",function(){!0===s(this).is(":checked")?s("#post-"+s(this).data("post-id")).addClass("selected"):s("#post-"+s(this).data("post-id")).removeClass("selected"),e()}),s(document).on("change","#post_type",function(){i()}),s(".post_category").change(function(){i()}),s("#post_status").change(function(){i()}),s(document).on("click","#search-submit",function(){return a(),!1}),s('input[name="image_alignment"]').click(function(){g()}),s('input[name="post_content"]').click(function(){d(),_(),g()}),s('input[name="title_tag"]').click(function(){d(),_(),g()}),s(function(){a()}),s(window).scroll(function(){!1===totalReached&&10<=s("#results li").length&&!wysappend&&s(window).scrollTop()===s(document).height()-s(window).height()&&w()})});